@{
    ViewData["Title"] = "Import Observations";
    Layout = "~/Views/MainLayout/Index.cshtml";
}

<div class="card">
    <div class="card-header border-0 pt-6">
        <div class="card-title">
            <h3 class="card-title align-items-start flex-column">
                <span class="card-label fw-bold text-dark">Import Observations</span>
                <span class="text-muted mt-1 fw-semibold fs-7">Upload your Excel files to import observations</span>
            </h3>
        </div>
        <div class="card-toolbar">
            <div class="d-flex justify-content-end">
                <a href="#" class="btn btn-light-primary me-3" data-bs-toggle="modal" data-bs-target="#importGuideModal">
                    <i class="bi bi-question-circle fs-4 me-1"></i>
                    Import Guide
                </a>
            </div>
        </div>
    </div>
    <div class="card-body">
        <form id="importForm" class="form" enctype="multipart/form-data">
            <div class="alert alert-primary d-flex align-items-center p-5 mb-10">
                <i class="bi bi-info-circle fs-2x text-primary me-4"></i>
                <div class="d-flex flex-column">
                    <span>Please ensure your Excel file follows the required format. Download the template if needed.</span>
                    <a href="#" id="downloadTemplate" class="text-primary fw-bold mt-2">Download Template</a>
                </div>
            </div>

            <div class="dropzone dz-clickable" id="importDropzone">
                <div class="dz-message needsclick">
                    <i class="bi bi-file-earmark-excel fs-3x text-primary"></i>
                    <div class="ms-4">
                        <h3 class="fs-5 fw-bold text-gray-900 mb-1">Drop files here or click to upload.</h3>
                        <span class="fs-7 fw-semibold text-gray-400 d-block">Upload Excel files only (.xlsx, .xls)</span>
                        <span class="fs-7 fw-semibold text-gray-400 d-block">Maximum file size: 50MB</span>
                    </div>
                </div>
            </div>

            <div id="importProgress" class="d-none mt-5">
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <div class="d-flex align-items-center">
                        <span id="progressText" class="text-muted me-3 fs-6">Processing...</span>
                        <span id="progressPercentage" class="text-muted fs-6 fw-bold">0%</span>
                    </div>
                    <button type="button" class="btn btn-sm btn-icon btn-light" id="cancelProgress">
                        <i class="bi bi-x fs-2"></i>
                    </button>
                </div>
                <div class="progress h-6px w-100">
                    <div id="progressBar" class="progress-bar bg-primary" role="progressbar" style="width: 0%"
                         aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>
            <div id="importResults" class="d-none mt-5">
                <div class="separator separator-dashed my-5"></div>
                <div class="d-flex flex-column">
                    <div class="d-flex align-items-center mb-2">
                        <span class="bullet bullet-vertical h-40px bg-success"></span>
                        <div class="flex-grow-1 ms-5">
                            <span id="successCount" class="text-gray-800 fw-bold fs-6">0</span>
                            <span class="text-muted fw-semibold d-block">Records imported successfully</span>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <span class="bullet bullet-vertical h-40px bg-danger"></span>
                        <div class="flex-grow-1 ms-5">
                            <span id="errorCount" class="text-gray-800 fw-bold fs-6">0</span>
                            <span class="text-muted fw-semibold d-block">Failed records</span>
                        </div>
                    </div>
                </div>
                <div class="mt-5" id="errorDetails" style="display: none;">
                    <span class="text-muted fw-bold fs-6">Error Details:</span>
                    <div class="text-danger mt-2" id="errorMessage"></div>
                </div>
            </div>
            <div class="text-center mt-8">
                <button type="reset" class="btn btn-light me-3" id="cancelButton">
                    <span class="indicator-label">Cancel</span>
                </button>
                <button type="submit" class="btn btn-primary" id="submitButton" data-kt-indicator="off">
                    <span class="indicator-label">Import Data</span>
                    <span class="indicator-progress">
                        Please wait...
                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                    </span>
                </button>
            </div>
        </form>
    </div>
</div>

<!--begin::Modal-->
<div class="modal fade" id="importGuideModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered mw-650px">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Import Guide</h2>
                <div class="btn btn-sm btn-icon btn-active-color-primary" data-bs-dismiss="modal">
                    <i class="bi bi-x fs-1"></i>
                </div>
            </div>
            <div class="modal-body scroll-y mx-5 mx-xl-15 my-7">
                <div class="mb-5">
                    <h4 class="fw-bold text-dark mb-3">Excel File Requirements:</h4>
                    <ul class="fs-6 fw-semibold mb-5">
                        <li>File must be in .xlsx or .xls format</li>
                        <li>Maximum file size is 50MB</li>
                        <li>Follow the template structure</li>
                        <li>Required fields must not be empty</li>
                    </ul>
                </div>
                <div class="mb-5">
                    <h4 class="fw-bold text-dark mb-3">Steps to Import:</h4>
                    <ol class="fs-6 fw-semibold">
                        <li>Download the template (if needed)</li>
                        <li>Fill in your data following the template format</li>
                        <li>Drag and drop or click to upload your file</li>
                        <li>Click "Import Data" to start the import process</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/dropzone/dropzone.min.js"></script>
    <script src="~/js/import/import-handler.js"></script>
    <script src="~/js/import/import-template.js"></script>
}
@section Styles {
    <link href="~/lib/dropzone/dropzone.min.css" rel="stylesheet" type="text/css" />
    <style>
        .dropzone {
            border: 2px dashed #009ef7;
            border-radius: 6px;
            padding: 20px;
            min-height: 200px;
            background: #f9f9f9;
        }

            .dropzone .dz-message {
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 2em 0;
            }

        .progress {
            background-color: #f5f8fa;
        }

        .dz-preview {
            margin: 1em;
        }

            .dz-preview .dz-details {
                padding: 1em;
            }
    </style>
}
