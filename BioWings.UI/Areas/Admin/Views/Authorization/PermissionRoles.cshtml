@model BioWings.UI.Areas.Admin.Models.Authorization.PermissionRoleManagementViewModel
@{
    ViewData["Title"] = "Permission-Role Eşleşmeleri";
    Layout = "~/Areas/Admin/Views/AdminMainLayout/Index.cshtml";
}

<div class="card">
    <div class="card-header border-0 pt-6">
        <div class="card-title">
            <h3 class="fw-bold m-0">Permission-Role Eşleşmeleri</h3>
        </div>
        <div class="card-toolbar">
            <div class="d-flex justify-content-end">
                <!-- Arama kutusu -->
                <div class="input-group me-2" style="width: 300px;">
                    <span class="input-group-text">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" id="permissionSearch" class="form-control" placeholder="Permission ara...">
                </div>

                <!-- Geri Dön butonu -->
                <a href="@Url.Action("Index")" class="btn btn-light-secondary me-2">
                    <span class="svg-icon svg-icon-2">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11.2657 11.4343L15.8991 7.7875C16.2257 7.53284 16.2257 7.08716 15.8991 6.83252C15.5725 6.57788 15.1258 6.57788 14.7991 6.83252L9.7991 10.8325C9.47248 11.087 9.47248 11.533 9.7991 11.7875L14.7991 15.7875C15.1258 16.0422 15.5725 16.0422 15.8991 15.7875C16.2257 15.533 16.2257 15.087 15.8991 14.8325L11.2657 11.4343Z" fill="currentColor"/>
                        </svg>
                    </span>
                    Geri Dön
                </a>
            </div>
        </div>
    </div>

    <div class="card-body py-4">
        @if (TempData.ContainsKey("SuccessMessage"))
        {
            <div class="alert alert-success d-flex align-items-center p-5 mb-10">
                <span class="svg-icon svg-icon-2hx svg-icon-success me-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10.0813 3.7242C10.8849 2.16438 13.1151 2.16438 13.9187 3.7242V3.7242C14.4016 4.66147 15.4909 5.1127 16.4951 4.79139V4.79139C18.1663 4.25668 19.7433 5.83365 19.2086 7.50485V7.50485C18.8873 8.50905 19.3385 9.59842 20.2758 10.0813V10.0813C21.8356 10.8849 21.8356 13.1151 20.2758 13.9187V13.9187C19.3385 14.4016 18.8873 15.491 19.2086 16.4951V16.4951C19.7433 18.1663 18.1663 19.7433 16.4951 19.2086V19.2086C15.491 18.8873 14.4016 19.3385 13.9187 20.2758V20.2758C13.1151 21.8356 10.8849 21.8356 10.0813 20.2758V20.2758C9.59842 19.3385 8.50905 18.8873 7.50485 19.2086V19.2086C5.83365 19.7433 4.25668 18.1663 4.79139 16.4951V16.4951C5.1127 15.491 4.66147 14.4016 3.7242 13.9187V13.9187C2.16438 13.1151 2.16438 10.8849 3.7242 10.0813V10.0813C4.66147 9.59842 5.1127 8.50905 4.79139 7.50485V7.50485C4.25668 5.83365 5.83365 4.25668 7.50485 4.79139V4.79139C8.50905 5.1127 9.59842 4.66147 10.0813 3.7242V3.7242Z" fill="currentColor"/>
                        <path d="M14.8563 9.1903C15.0606 8.94984 15.0606 8.56199 14.8563 8.32153C14.6521 8.08107 14.2643 8.08107 14.0601 8.32153L10.4597 11.9219L9.94101 11.4032C9.73676 11.1627 9.34891 11.1627 9.14467 11.4032C8.94042 11.6436 8.94042 12.0315 9.14467 12.2719L10.062 13.1893C10.2663 13.4297 10.6541 13.4297 10.8584 13.1893L14.8563 9.1903Z" fill="white"/>
                    </svg>
                </span>
                <div class="d-flex flex-column">
                    <h4 class="mb-1 text-success">Başarılı!</h4>
                    <span>@TempData["SuccessMessage"]</span>
                </div>
            </div>
        }

        @if (TempData.ContainsKey("ErrorMessage"))
        {
            <div class="alert alert-danger d-flex align-items-center p-5 mb-10">
                <span class="svg-icon svg-icon-2hx svg-icon-danger me-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="currentColor"/>
                        <rect x="11" y="14" width="7" height="2" rx="1" transform="rotate(-90 11 14)" fill="currentColor"/>
                        <rect x="11" y="17" width="2" height="2" rx="1" transform="rotate(-90 11 17)" fill="currentColor"/>
                    </svg>
                </span>
                <div class="d-flex flex-column">
                    <h4 class="mb-1 text-danger">Hata!</h4>
                    <span>@TempData["ErrorMessage"]</span>
                </div>
            </div>
        }

        @if (ViewData.ContainsKey("ErrorMessage"))
        {
            <div class="alert alert-danger d-flex align-items-center p-5 mb-10">
                <span class="svg-icon svg-icon-2hx svg-icon-danger me-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="currentColor"/>
                        <rect x="11" y="14" width="7" height="2" rx="1" transform="rotate(-90 11 14)" fill="currentColor"/>
                        <rect x="11" y="17" width="2" height="2" rx="1" transform="rotate(-90 11 17)" fill="currentColor"/>
                    </svg>
                </span>
                <div class="d-flex flex-column">
                    <h4 class="mb-1 text-danger">Hata!</h4>
                    <span>@ViewData["ErrorMessage"]</span>
                </div>
            </div>
        }

        <form method="post" asp-area="Admin" asp-controller="Authorization" asp-action="SavePermissionRoles" id="permissionRolesForm">
            @Html.AntiForgeryToken()
            <!-- Kaydet butonu -->
            <div class="d-flex justify-content-end mb-5">
                <button type="submit" class="btn btn-success" id="saveButton">
                    <span class="svg-icon svg-icon-2">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14.4 11H3C2.4 11 2 11.4 2 12C2 12.6 2.4 13 3 13H14.4V11Z" fill="currentColor"/>
                            <path opacity="0.3" d="M14.4 20V4L22 12L14.4 20Z" fill="currentColor"/>
                        </svg>
                    </span>
                    Değişiklikleri Kaydet
                </button>
            </div>

            <!-- Ana tablo -->
            <div class="table-responsive">
                <table class="table align-middle table-row-dashed fs-6 gy-5" id="kt_permission_roles_table">
                    <thead>
                        <tr class="text-start text-muted fw-bold fs-7 text-uppercase gs-0">
                            <th class="min-w-200px">Permission</th>
                            <th class="min-w-150px">Controller</th>
                            <th class="min-w-100px">Action</th>
                            <th class="min-w-100px">Tür</th>
                            <th class="min-w-100px">HTTP</th>
                            <th class="min-w-300px text-center">Roller</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-600 fw-semibold">
                        @if (Model != null && Model.Permissions.Any())
                        {
                            foreach (var permission in Model.Permissions)
                            {
                                <tr>
                                    <td>
                                        <div class="d-flex flex-column">
                                            <span class="text-gray-800 fw-bold mb-1">@permission.Definition</span>
                                            <span class="text-muted fs-7">@permission.PermissionCode</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge badge-primary fw-bold">@permission.ControllerName</span>
                                    </td>
                                    <td>
                                        <span class="text-gray-800">@permission.ActionName</span>
                                    </td>
                                    <td>
                                        @switch (permission.ActionType)
                                        {
                                            case "Read":
                                                <span class="badge badge-success fw-bold">@permission.ActionType</span>
                                                break;
                                            case "Write":
                                                <span class="badge badge-info fw-bold">@permission.ActionType</span>
                                                break;
                                            case "Update":
                                                <span class="badge badge-warning fw-bold">@permission.ActionType</span>
                                                break;
                                            case "Delete":
                                                <span class="badge badge-danger fw-bold">@permission.ActionType</span>
                                                break;
                                            default:
                                                <span class="badge badge-dark fw-bold">@permission.ActionType</span>
                                                break;
                                        }
                                    </td>
                                    <td>
                                        <span class="badge badge-secondary fw-bold">@permission.HttpType</span>
                                    </td>
                                    <td>
                                        <div class="d-flex flex-wrap gap-2 justify-content-center">
                                            @foreach (var role in Model.Roles)
                                            {
                                                <div class="form-check form-check-custom form-check-solid">
                                                    <input class="form-check-input" 
                                                           type="checkbox" 
                                                           name="permissionRoles[@permission.PermissionId]" 
                                                           value="@role.Id" 
                                                           id="permission_@(permission.PermissionId)_role_@(role.Id)"
                                                           @(permission.SelectedRoleIds.Contains(role.Id) ? "checked" : "") />
                                                    <label class="form-check-label fw-semibold text-gray-700" 
                                                           for="permission_@(permission.PermissionId)_role_@(role.Id)">
                                                        @role.Name
                                                    </label>
                                                </div>
                                            }
                                        </div>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="6" class="text-center py-10">
                                    <div class="d-flex flex-column align-items-center">
                                        <span class="fs-5 fw-semibold text-gray-400">Henüz hiç permission bulunamadı.</span>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </form>
    </div>
</div>

<script src="~/js/Authorization/permission-roles.js"></script>
