@model List<BioWings.UI.Areas.Admin.Models.Authorization.AuthorizationDefinitionViewModel>
@{
    ViewData["Title"] = "Yetkilendirme Tanımları";
    Layout = "~/Areas/Admin/Views/AdminMainLayout/Index.cshtml";
}

<div class="card">
    <div class="card-header border-0 pt-6">
        <div class="card-title">
            <h3 class="fw-bold m-0">Yetkilendirme Tanımları</h3>
        </div>
        <div class="card-toolbar">
            <div class="d-flex justify-content-end">
                <!-- Arama kutusu -->
                <div class="input-group me-2" style="width: 300px;">
                    <span class="input-group-text">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" id="customSearch" class="form-control" placeholder="Controller, Action, Menü ara...">
                </div>

                <!-- Yetkileri Güncelle butonu -->
                <form method="post" asp-action="Sync" class="d-inline me-2" id="syncForm">
                    <button type="button" class="btn btn-warning" id="syncButton">
                        <span class="svg-icon svg-icon-2">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20 14H18V10H20C20.6 10 21 10.4 21 11V13C21 13.6 20.6 14 20 14ZM21 19V17C21 16.4 20.6 16 20 16H18V12H20C20.6 12 21 11.6 21 11V9C21 8.4 20.6 8 20 8H18V4C18 3.4 17.6 3 17 3H7C6.4 3 6 3.4 6 4V8H4C3.4 8 3 8.4 3 9V11C3 11.6 3.4 12 4 12H6V16H4C3.4 16 3 16.4 3 17V19C3 19.6 3.4 20 4 20H6V21C6 21.6 6.4 22 7 22H17C17.6 22 18 21.6 18 21V20H20C20.6 20 21 19.6 21 19ZM5 10V14H4V10H5ZM19 10V14H20V10H19ZM16 4V20H8V4H16Z" fill="currentColor"/>
                            </svg>
                        </span>
                        Yetkileri Güncelle
                    </button>
                </form>

                <!-- Yenile butonu -->
                <button type="button" class="btn btn-light-success" onclick="location.reload()">
                    <span class="svg-icon svg-icon-2">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14.5 20.7259C14.6448 21.2216 14.2384 21.7 13.7312 21.6194C12.1969 21.3825 10.7679 20.7252 9.57918 19.7174C8.39043 18.7096 7.48648 17.3854 6.9498 15.8661C6.41312 14.3469 6.26956 12.6954 6.53462 11.0821C6.79968 9.4687 7.46245 7.95364 8.46006 6.69997C9.45767 5.4463 10.7527 4.49481 12.2278 3.95378C13.7029 3.41275 15.3046 3.29963 16.8456 3.6259C18.3866 3.95218 19.8069 4.71906 20.9505 5.84235C22.0941 6.96564 22.9158 8.40034 23.3259 9.96839L23.5259 10.7684C23.6086 11.0924 23.3572 11.4016 23.0332 11.4016C22.7092 11.4016 22.4578 11.0924 22.3751 10.7684L22.1751 9.96839C21.8315 8.66887 21.1452 7.47604 20.1854 6.52657C19.2257 5.5771 18.0259 4.90318 16.7196 4.57887C15.4133 4.25456 14.0448 4.29175 12.7588 4.68689C11.4729 5.08202 10.3143 5.82024 9.40905 6.82332C8.50386 7.8264 7.88594 9.05923 7.62169 10.3934C7.35745 11.7276 7.45771 13.1108 7.91129 14.3944C8.36487 15.6779 9.15509 16.8154 10.2002 17.6846C11.2454 18.5538 12.5055 19.1224 13.8435 19.3314C14.3706 19.4142 14.8214 19.9893 14.5 20.7259Z" fill="currentColor"/>
                        </svg>
                    </span>
                    Yenile
                </button>
            </div>
        </div>
    </div>

    <div class="card-body py-4">
        @if (TempData.ContainsKey("SuccessMessage"))
        {
            <div class="alert alert-success d-flex align-items-center p-5 mb-10">
                <span class="svg-icon svg-icon-2hx svg-icon-success me-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10.0813 3.7242C10.8849 2.16438 13.1151 2.16438 13.9187 3.7242V3.7242C14.4016 4.66147 15.4909 5.1127 16.4951 4.79139V4.79139C18.1663 4.25668 19.7433 5.83365 19.2086 7.50485V7.50485C18.8873 8.50905 19.3385 9.59842 20.2758 10.0813V10.0813C21.8356 10.8849 21.8356 13.1151 20.2758 13.9187V13.9187C19.3385 14.4016 18.8873 15.491 19.2086 16.4951V16.4951C19.7433 18.1663 18.1663 19.7433 16.4951 19.2086V19.2086C15.491 18.8873 14.4016 19.3385 13.9187 20.2758V20.2758C13.1151 21.8356 10.8849 21.8356 10.0813 20.2758V20.2758C9.59842 19.3385 8.50905 18.8873 7.50485 19.2086V19.2086C5.83365 19.7433 4.25668 18.1663 4.79139 16.4951V16.4951C5.1127 15.491 4.66147 14.4016 3.7242 13.9187V13.9187C2.16438 13.1151 2.16438 10.8849 3.7242 10.0813V10.0813C4.66147 9.59842 5.1127 8.50905 4.79139 7.50485V7.50485C4.25668 5.83365 5.83365 4.25668 7.50485 4.79139V4.79139C8.50905 5.1127 9.59842 4.66147 10.0813 3.7242V3.7242Z" fill="currentColor"/>
                        <path d="M14.8563 9.1903C15.0606 8.94984 15.0606 8.56199 14.8563 8.32153C14.6521 8.08107 14.2643 8.08107 14.0601 8.32153L10.4597 11.9219L9.94101 11.4032C9.73676 11.1627 9.34891 11.1627 9.14467 11.4032C8.94042 11.6436 8.94042 12.0315 9.14467 12.2719L10.062 13.1893C10.2663 13.4297 10.6541 13.4297 10.8584 13.1893L14.8563 9.1903Z" fill="white"/>
                    </svg>
                </span>
                <div class="d-flex flex-column">
                    <h4 class="mb-1 text-success">Başarılı!</h4>
                    <span>@TempData["SuccessMessage"]</span>
                </div>
            </div>
        }

        @if (TempData.ContainsKey("ErrorMessage"))
        {
            <div class="alert alert-danger d-flex align-items-center p-5 mb-10">
                <span class="svg-icon svg-icon-2hx svg-icon-danger me-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="currentColor"/>
                        <rect x="11" y="14" width="7" height="2" rx="1" transform="rotate(-90 11 14)" fill="currentColor"/>
                        <rect x="11" y="17" width="2" height="2" rx="1" transform="rotate(-90 11 17)" fill="currentColor"/>
                    </svg>
                </span>
                <div class="d-flex flex-column">
                    <h4 class="mb-1 text-danger">Hata!</h4>
                    <span>@TempData["ErrorMessage"]</span>
                </div>
            </div>
        }

        @if (ViewData.ContainsKey("ErrorMessage"))
        {
            <div class="alert alert-danger d-flex align-items-center p-5 mb-10">
                <span class="svg-icon svg-icon-2hx svg-icon-danger me-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="currentColor"/>
                        <rect x="11" y="14" width="7" height="2" rx="1" transform="rotate(-90 11 14)" fill="currentColor"/>
                        <rect x="11" y="17" width="2" height="2" rx="1" transform="rotate(-90 11 17)" fill="currentColor"/>
                    </svg>
                </span>
                <div class="d-flex flex-column">
                    <h4 class="mb-1 text-danger">Hata!</h4>
                    <span>@ViewData["ErrorMessage"]</span>
                </div>
            </div>
        }

        <!-- Ana tablo -->
        <div class="table-responsive">
            <table class="table align-middle table-row-dashed fs-6 gy-5" id="kt_authorization_table">
                <thead>
                    <tr class="text-start text-muted fw-bold fs-7 text-uppercase gs-0">
                        <th class="min-w-125px">Controller</th>
                        <th class="min-w-150px">Action</th>
                        <th class="min-w-125px">Menü</th>
                        <th class="min-w-100px">Yetki Türü</th>
                        <th class="min-w-200px">Açıklama</th>
                        <th class="min-w-100px">Alan</th>
                    </tr>
                </thead>
                <tbody class="text-gray-600 fw-semibold">
                    @if (Model != null && Model.Any())
                    {
                        foreach (var item in Model)
                        {
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <span class="svg-icon svg-icon-2 me-2">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path opacity="0.3" d="M22 12C22 17.5 17.5 22 12 22S2 17.5 2 12S6.5 2 12 2S22 6.5 22 12ZM12 7C10.3 7 9 8.3 9 10C9 11.7 10.3 13 12 13C13.7 13 15 11.7 15 10C15 8.3 13.7 7 12 7Z" fill="currentColor"/>
                                                <path d="M12 22C14.6 22 17 20.8 19.1 18.9C17.2 16.9 14.8 15.8 12 15.8C9.2 15.8 6.8 16.9 4.9 18.9C7 20.8 9.4 22 12 22Z" fill="currentColor"/>
                                            </svg>
                                        </span>
                                        <span class="fw-bold">@item.ControllerName</span>
                                    </div>
                                </td>
                                <td>
                                    <span class="badge badge-primary fw-bold">@item.ActionName</span>
                                </td>
                                <td>
                                    <span class="text-gray-800 fw-bold">@item.MenuName</span>
                                </td>
                                <td>
                                    @switch (item.ActionType)
                                    {
                                        case "Read":
                                            <span class="badge badge-success fw-bold">
                                               @item.ActionType
                                            </span>
                                            break;
                                        case "Write":
                                            <span class="badge badge-info fw-bold">
                                               @item.ActionType
                                            </span>
                                            break;
                                        case "Update":
                                            <span class="badge badge-warning fw-bold">
                                               @item.ActionType
                                            </span>
                                            break;
                                        case "Delete":
                                            <span class="badge badge-danger fw-bold">
                                                @item.ActionType
                                            </span>
                                            break;
                                        default:
                                            <span class="badge badge-dark fw-bold">@item.ActionType</span>
                                            break;
                                    }
                                </td>
                                <td>
                                    <span class="text-gray-600">@item.Definition</span>
                                </td>
                                <td>
                                    @if (item.AreaName == "Admin")
                                    {
                                        <span class="badge badge-danger fw-bold">
                                            <i class="fas fa-shield-alt me-1"></i>@item.AreaName
                                        </span>
                                    }
                                    else if (string.IsNullOrEmpty(item.AreaName))
                                    {
                                        <span class="badge badge-success fw-bold">
                                            <i class="fas fa-globe me-1"></i>Public
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge badge-primary fw-bold">@item.AreaName</span>
                                    }
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="6" class="text-center py-10">
                                <div class="d-flex flex-column align-items-center">
                                    <span class="fs-5 fw-semibold text-gray-400">Henüz hiç yetkilendirme tanımı bulunamadı.</span>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="~/js/Authorization/authorization-index.js"></script> 